{% extends 'base/base.html' %}
{% load crispy_forms_tags %}
{% load static%}

<title>Change Password</title>

{% block 'body' %}
<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card">
        <div class="card-header">
          <h2><i class="fas fa-key me-2"></i> Change Password</h2>
        </div>
        <div class="card-body">
          <form method="post" novalidate>
            {% csrf_token %}

            <div class="mb-3">
              
              {{ form.old_password|as_crispy_field }}
              {% for error in form.old_password.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="mb-3 position-relative">
              
              {{ form.new_password1|as_crispy_field }}
              {% for error in form.new_password1.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
              <i class="fas fa-eye toggle-password" data-target="id_new_password1"></i>
            </div>

            <div class="mb-3 position-relative">
              {{ form.old_password|as_crispy_field }}
              {% for error in form.new_password2.errors %}
                <div class="text-danger small">{{ error }}</div>
              {% endfor %}
              <i class="fas fa-eye toggle-password" data-target="id_new_password2"></i>
            </div>

            <div class="d-flex justify-content-end">
              <button type="submit" class="btn btn-success me-2">
                <i class="fas fa-save me-1"></i> Change Password
              </button>
              <a href="{% url 'profile' %}" class="btn btn-secondary">Cancel</a>
            </div>
            <p class="mt-2"><a href="{% url 'password_reset' %}">Forgot Old password?</a></p>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .toggle-password {
    position: absolute;
    right: 15px;
    top: 42px;
    cursor: pointer;
    color: #999;
  }
</style>

<script>
  document.querySelectorAll('.toggle-password').forEach(icon => {
    icon.addEventListener('click', function () {
      const target = document.getElementById(this.dataset.target);
      if (target.type === 'password') {
        target.type = 'text';
        this.classList.remove('fa-eye');
        this.classList.add('fa-eye-slash');
      } else {
        target.type = 'password';
        this.classList.remove('fa-eye-slash');
        this.classList.add('fa-eye');
      }
    });
  });
</script>
{% endblock %}